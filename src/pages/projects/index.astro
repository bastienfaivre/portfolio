---
import Layout from "../../layouts/Layout.astro";
import { createWebPageSchema, createBreadcrumbSchema } from "../../lib/seo";
import projectsData from "../../data/projects.json";

const webPageSchema = createWebPageSchema(
  "My Projects",
  "My projects",
  "https://bastienfaivre.com/projects",
);

const breadcrumbSchema = createBreadcrumbSchema([
  { name: "Home", url: "https://bastienfaivre.com" },
  { name: "Projects" },
]);

interface Project {
  title: string;
  company: string;
  status: "active" | "maintenance" | "archived";
  period: string;
  description: string;
  technologies: string[];
  website?: string;
  code?: string;
  paper?: string;
  highlight?: boolean;
}

const projects = projectsData as Project[];

const activeProjects = projects.filter((p) => p.status === "active");
const maintenanceProjects = projects.filter((p) => p.status === "maintenance");
const archivedProjects = projects.filter((p) => p.status === "archived");

---

<style is:global>
  .info-icon:hover .info-tooltip,
  .info-icon.active .info-tooltip {
    opacity: 1;
    pointer-events: auto;
  }

  .project-bar.has-open-description {
    border-radius: 0.5rem 0.5rem 0 0;
  }

  .project-description {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s linear;
  }

  .project-description.open {
    border: 1px solid #404040;
    border-top: none;
  }
</style>

<script>
  window.addEventListener("load", () => {
    const loader = document.querySelector(".loader") as HTMLElement;
    if (loader) {
      setTimeout(() => {
        loader.classList.add("loader-hidden");
      }, 100);
    }

    const infoIcons = document.querySelectorAll(".info-icon");
    infoIcons.forEach((icon) => {
      icon.addEventListener("click", (e) => {
        e.stopPropagation();
        icon.classList.toggle("active");
      });
    });
    document.addEventListener("click", () => {
      infoIcons.forEach((icon) => icon.classList.remove("active"));
    });

    const moreInfoButtons = document.querySelectorAll(".more-info-btn");
    moreInfoButtons.forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const item = btn.closest(".project-item");
        const description = item?.querySelector(
          ".project-description",
        ) as HTMLElement;
        const bar = item?.querySelector(".project-bar");

        if (description && bar) {
          const isOpen = description.classList.contains("open");

          // Close all other descriptions and reset their buttons
          document
            .querySelectorAll(".project-description.open")
            .forEach((desc) => {
              if (desc !== description) {
                const descElement = desc as HTMLElement;
                const descItem = descElement.closest(".project-item");
                const descBar = descItem?.querySelector(".project-bar");
                const descBtn = descItem?.querySelector(".more-info-btn");
                descElement.style.maxHeight = "0";
                desc.classList.remove("open");
                descBar?.classList.remove("has-open-description");
                if (descBtn) descBtn.textContent = "more ↓";
              }
            });

          if (isOpen) {
            description.style.maxHeight = "0";
            description.classList.remove("open");
            bar.classList.remove("has-open-description");
            btn.textContent = "more ↓";
          } else {
            const content = description.querySelector(
              ".project-description-content",
            ) as HTMLElement;
            description.style.maxHeight = content.scrollHeight + "px";
            description.classList.add("open");
            bar.classList.add("has-open-description");
            btn.textContent = "less ↑";
          }
        }
      });
    });
  });
</script>

<Layout
  title="Bastien Faivre - Projects"
  description="My projects"
  schemas={[webPageSchema, breadcrumbSchema]}
>
  <main
    class="w-screen h-screen flex flex-col justify-start items-start max-w-3xl mx-auto p-8"
  >
    <a
      href="/"
      class="text-gray-100 bg-gray-900 hover:bg-gray-800 hover:border-primary-500 px-4 py-2 mb-8 border-1 border-solid border-gray-600 rounded-lg font-light inline-block transition-colors duration-200"
    >
      Back
    </a>

    <h1 class="text-4xl font-bold mb-2 text-gray-100">My Projects</h1>
    <p class="text-lg text-gray-200 font-light mb-12">
      Projects I've worked on throughout my career
    </p>

    <div class="flex flex-col gap-12 pb-8 w-full">
      <section>
        <div class="flex items-center gap-2 mb-4">
          <h2 class="text-2xl font-semibold text-gray-100">Active Projects</h2>
        </div>
        {
          activeProjects.length > 0 ? (
            <div class="flex flex-col gap-4">
              {activeProjects.map((project) => (
                <div class="project-item relative">
                  <div class="project-bar relative bg-gray-900 border border-gray-600 rounded-lg py-3 px-4 transition-colors duration-200 w-full">
                    <div class="font-semibold text-gray-100 text-base flex items-center gap-2">
                      <span>{project.title}</span>
                      <div class="flex items-center gap-2">
                        {project.website && (
                          <a
                            href={project.website}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center text-gray-400 hover:text-primary-500 transition-colors duration-200"
                            onclick="event.stopPropagation()"
                            title="Website"
                            aria-label="Website"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="16"
                              height="16"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              aria-hidden="true"
                            >
                              <circle cx="12" cy="12" r="10" />
                              <line x1="2" y1="12" x2="22" y2="12" />
                              <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                            </svg>
                          </a>
                        )}
                        {project.code && (
                          <a
                            href={project.code}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center text-gray-400 hover:text-primary-500 transition-colors duration-200"
                            onclick="event.stopPropagation()"
                            title="Source Code"
                            aria-label="Source Code"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="16"
                              height="16"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              aria-hidden="true"
                            >
                              <polyline points="16 18 22 12 16 6" />
                              <polyline points="8 6 2 12 8 18" />
                            </svg>
                          </a>
                        )}
                        {project.paper && (
                          <a
                            href={project.paper}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center text-gray-400 hover:text-primary-500 transition-colors duration-200"
                            onclick="event.stopPropagation()"
                            title="Paper"
                            aria-label="Paper"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="16"
                              height="16"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              aria-hidden="true"
                            >
                              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                              <polyline points="14 2 14 8 20 8" />
                              <line x1="16" y1="13" x2="8" y2="13" />
                              <line x1="16" y1="17" x2="8" y2="17" />
                              <polyline points="10 9 9 9 8 9" />
                            </svg>
                          </a>
                        )}
                      </div>
                    </div>
                    <div class="text-sm text-gray-400 font-light mt-1 flex items-center justify-between">
                      <span>
                        {project.company} • {project.period}
                      </span>
                      <button class="more-info-btn bg-transparent border-none cursor-pointer font-medium text-primary-500 hover:text-primary-400 transition-colors duration-200 text-xs">
                        more ↓
                      </button>
                    </div>
                  </div>
                  <div class="project-description bg-darkslate-900 border-none rounded-b-lg mt-0">
                    <div class="project-description-content p-4">
                      <p class="text-sm text-gray-200 font-light mb-3">
                        {project.description}
                      </p>
                      <div class="flex flex-wrap gap-1">
                        {project.technologies.map((tech) => (
                          <span class="inline-block bg-gray-800 text-gray-400 py-1 px-2 rounded text-xs mr-1 mt-1">{tech}</span>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <p class="text-gray-400 font-light">
              I am currently not working on any active project.
            </p>
          )
        }
      </section>

      {
        maintenanceProjects.length > 0 && (
          <section>
            <div class="flex items-center gap-2 mb-4">
              <h2 class="text-2xl font-semibold text-gray-100">In Maintenance</h2>
              <div class="info-icon cursor-help text-gray-500 text-base relative">
                ⓘ
                <div class="info-tooltip absolute bottom-[100%] left-1/2 -translate-x-1/2 mb-2 bg-gray-900 border border-gray-700 rounded-lg p-3 w-[250px] text-xs text-gray-400 opacity-0 pointer-events-none transition-opacity duration-200 z-100">
                  These are projects I maintain with updates, bug fixes, and
                  security patches, but no active feature development.
                </div>
              </div>
            </div>
            <div class="flex flex-col gap-4">
              {maintenanceProjects.map((project) => (
                <div class="project-item relative">
                  <div class="project-bar relative bg-gray-900 border border-gray-600 rounded-lg py-3 px-4 transition-colors duration-200 w-full">
                    <div class="font-semibold text-gray-100 text-base flex items-center gap-2">
                      <span>{project.title}</span>
                      <div class="flex items-center gap-2">
                        {project.website && (
                          <a
                            href={project.website}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center text-gray-400 hover:text-primary-500 transition-colors duration-200"
                            onclick="event.stopPropagation()"
                            title="Website"
                            aria-label="Website"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="16"
                              height="16"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              aria-hidden="true"
                            >
                              <circle cx="12" cy="12" r="10" />
                              <line x1="2" y1="12" x2="22" y2="12" />
                              <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                            </svg>
                          </a>
                        )}
                        {project.code && (
                          <a
                            href={project.code}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center text-gray-400 hover:text-primary-500 transition-colors duration-200"
                            onclick="event.stopPropagation()"
                            title="Source Code"
                            aria-label="Source Code"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="16"
                              height="16"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              aria-hidden="true"
                            >
                              <polyline points="16 18 22 12 16 6" />
                              <polyline points="8 6 2 12 8 18" />
                            </svg>
                          </a>
                        )}
                        {project.paper && (
                          <a
                            href={project.paper}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center text-gray-400 hover:text-primary-500 transition-colors duration-200"
                            onclick="event.stopPropagation()"
                            title="Paper"
                            aria-label="Paper"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="16"
                              height="16"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              aria-hidden="true"
                            >
                              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                              <polyline points="14 2 14 8 20 8" />
                              <line x1="16" y1="13" x2="8" y2="13" />
                              <line x1="16" y1="17" x2="8" y2="17" />
                              <polyline points="10 9 9 9 8 9" />
                            </svg>
                          </a>
                        )}
                      </div>
                    </div>
                    <div class="text-sm text-gray-400 font-light mt-1 flex items-center justify-between">
                      <span>
                        {project.company} • {project.period}
                      </span>
                      <button class="more-info-btn bg-transparent border-none cursor-pointer font-medium text-primary-500 hover:text-primary-400 transition-colors duration-200 text-xs">
                        more ↓
                      </button>
                    </div>
                  </div>
                  <div class="project-description bg-darkslate-900 border-none rounded-b-lg mt-0">
                    <div class="project-description-content p-4">
                      <p class="text-sm text-gray-200 font-light mb-3">
                        {project.description}
                      </p>
                      <div class="flex flex-wrap gap-1">
                        {project.technologies.map((tech) => (
                          <span class="inline-block bg-gray-800 text-gray-400 py-1 px-2 rounded text-xs mr-1 mt-1">{tech}</span>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </section>
        )
      }

      {
        archivedProjects.length > 0 && (
          <section>
            <div class="flex items-center gap-2 mb-4">
              <h2 class="text-2xl font-semibold text-gray-100">Past Projects</h2>
            </div>
            <div class="flex flex-col gap-4">
              {archivedProjects.map((project) => (
                <div class="project-item relative">
                  <div class="project-bar relative bg-gray-900 border border-gray-600 rounded-lg py-3 px-4 transition-colors duration-200 w-full">
                    <div class="font-semibold text-gray-100 text-base flex items-center gap-2">
                      <span>{project.title}</span>
                      <div class="flex items-center gap-2">
                        {project.website && (
                          <a
                            href={project.website}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center text-gray-400 hover:text-primary-500 transition-colors duration-200"
                            onclick="event.stopPropagation()"
                            title="Website"
                            aria-label="Website"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="16"
                              height="16"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              aria-hidden="true"
                            >
                              <circle cx="12" cy="12" r="10" />
                              <line x1="2" y1="12" x2="22" y2="12" />
                              <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                            </svg>
                          </a>
                        )}
                        {project.code && (
                          <a
                            href={project.code}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center text-gray-400 hover:text-primary-500 transition-colors duration-200"
                            onclick="event.stopPropagation()"
                            title="Source Code"
                            aria-label="Source Code"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="16"
                              height="16"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              aria-hidden="true"
                            >
                              <polyline points="16 18 22 12 16 6" />
                              <polyline points="8 6 2 12 8 18" />
                            </svg>
                          </a>
                        )}
                        {project.paper && (
                          <a
                            href={project.paper}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center text-gray-400 hover:text-primary-500 transition-colors duration-200"
                            onclick="event.stopPropagation()"
                            title="Paper"
                            aria-label="Paper"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="16"
                              height="16"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              aria-hidden="true"
                            >
                              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                              <polyline points="14 2 14 8 20 8" />
                              <line x1="16" y1="13" x2="8" y2="13" />
                              <line x1="16" y1="17" x2="8" y2="17" />
                              <polyline points="10 9 9 9 8 9" />
                            </svg>
                          </a>
                        )}
                      </div>
                    </div>
                    <div class="text-sm text-gray-400 font-light mt-1 flex items-center justify-between">
                      <span>
                        {project.company} • {project.period}
                      </span>
                      <button class="more-info-btn bg-transparent border-none cursor-pointer font-medium text-primary-500 hover:text-primary-400 transition-colors duration-200 text-xs">
                        more ↓
                      </button>
                    </div>
                  </div>
                  <div class="project-description bg-darkslate-900 border-none rounded-b-lg mt-0">
                    <div class="project-description-content p-4">
                      <p class="text-sm text-gray-200 font-light mb-3">
                        {project.description}
                      </p>
                      <div class="flex flex-wrap gap-1">
                        {project.technologies.map((tech) => (
                          <span class="inline-block bg-gray-800 text-gray-400 py-1 px-2 rounded text-xs mr-1 mt-1">{tech}</span>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </section>
        )
      }
    </div>
  </main>
</Layout>
